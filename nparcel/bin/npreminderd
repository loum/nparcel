#!/usr/bin/python

import os
import inspect

import nparcel
from nparcel.utils.log import (log,
                               set_log_level,
                               set_console)


def main():
    based = nparcel.BaseD()
    based.check_args()

    if based.command == 'status' or based.options.dry is not None:
        set_console()

    # Enable detailed logging if required.
    if based.options.verbose == 0:
        set_log_level('INFO')
    else:
        log.debug('Logging verbosity set to "DEBUG" level')

    # OK, start processing.
    pidfile = os.path.join(os.path.expanduser('~'),
                           '.nparceld',
                           'npreminderd.pid')
    remd = nparcel.ReminderDaemon(pidfile=pidfile,
                                  dry=based.dry,
                                  batch=based.batch,
                                  config=based.options.config)

    script_name = inspect.getfile(inspect.currentframe())
    script_name = os.path.basename(script_name)
    based.launch_command(remd, script_name)

if __name__ == '__main__':
    main()
